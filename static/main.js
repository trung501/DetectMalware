var host = this.origin;
function watchDocs() {
  console.log("Watching docs");
  window.location.replace(host + "/docs");
}
function createFeature() {
  console.log("Creating feature");
  document.querySelector("#info").innerHTML = `
  <div><h3>Trích xuất đặc trưng</h3></div>
  <form>
  <div>
    <label>Select a File PE : </label>
    <input type="file" />
  </div>
  <button>Upload</button>
</form>
<div id="result"></div>`;

  document.querySelector("#info form button").onclick = function (event) {
    event.preventDefault();
    console.log("Uploading PE");
    var input = document.querySelector('input[type="file"]');

    var data = new FormData();
    data.append("file", input.files[0]);
    html = ``;
    fetch("/createFeature", {
      method: "POST",
      body: data,
    })
      .then(function (response) {
        return response.json();
      })
      .then(function (data) {
        if (data.hasOwnProperty("0")) {
          data = data[0];
          for (var key in data) {
            html += `<div>${key}: ${data[key]}</div>`;
          }
        } else {
          html = `Có lỗi xảy ra, hãy chắc chắn bạn đã upload một file PE`;
        }
        document.querySelector("#info #result").innerHTML = html;
      });
  };
}
function DetectMalware() {
  console.log("Detecting malware");
  document.querySelector("#info").innerHTML = `
  <div><h3>Kiểm thử mã độc</h3></div>
  <form>
  <div>
    <label>Select a File PE : </label>
    <input type="file" />
  </div>
  <button>Upload</button>
</form>
<div id="result"></div>`;

  document.querySelector("#info form button").onclick = function (event) {
    event.preventDefault();
    console.log("Uploading PE");
    var input = document.querySelector('input[type="file"]');

    var data = new FormData();
    data.append("file", input.files[0]);
    html = ``;
    fetch("/detectMalware", {
      method: "POST",
      body: data,
    })
      .then(function (response) {
        return response.json();
      })
      .then(function (data) {
        if (data.hasOwnProperty("Percentage")) {
          if (data["Malware"] == true) {
            alert("Malware");
            html = `<h3>Đây là mã độc</h3>`;
            html += `<h3>Độ chính xác: ${data["Percentage"]}%</h3>`;
          } else {
            alert("Normal");
            html = `<h3>Đây không phải mã độc</h3>`;
            html += `<h3>Độ chính xác: ${data["Percentage"]}%</h3>`;
          }
        } else {
          html = `Có lỗi xảy ra, hãy chắc chắn bạn đã upload một file PE`;
        }
        document.querySelector("#info #result").innerHTML = html;
      });
  };
}
function AboutUs() {
  console.log("About Us");
  document.querySelector(
    "#info"
  ).innerHTML = `<h3>Chủ trì đề tài: Trần Bảo Trung</h3>
  <h3>Thành viên : Đinh Thị Thu Uyên</h3>
  <h3>Thành viên : Nguyễn Thảo Ngân</h3>`;
}

AboutUs();
